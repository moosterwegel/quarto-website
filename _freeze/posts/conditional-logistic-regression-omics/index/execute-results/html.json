{
  "hash": "3be71288a8d4b4ac5127da76d5ed6525",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"The superiority of conditional logistic regression in (metabol)omic matched case-control studies\"\ndraft: true\ndate: \"2025-06-20\"\nformat: \n  html: \n      echo: true\n      message: false\n      warning: false\n      code-fold: true\n---\n\nConditional logistic regression[^1] is a classic tool in an epidemiologist's toolkit. It's usually used to analyse matched case-control studies. However, popular guidance has advocated to 'break' the matching and analyse such studies using a ordinary logistic model for small efficiency gains. In this blog posts I want to demonstrate the clear superiority of conditional logistic regression in well-designed matched case-control studies of omic data that contain a substantial amount of technical variation.\n\n[^1]: In other fields also known as the hypergeomtric test, or '[as an estimator of the FE LR model](https://x.com/noah_greifer/status/1565747391734628353)'.\n\n\"conditional logistic regression. In this model, all cluster-constant covariates are absorbed into a cluster-specific intercept, whereas cluster-varying covariates are adjusted for by explicitly adding these as explanatory variables to the model.\"\n-  https://doi.org/10.1002/sim.8332 \n\n\"The key is that the CLR conditions out any factors constant within the matched pair (the stratum), and by making the assay batch/plate the randomization block for the pair, technical variation associated with that batch/plate gets conditioned out too.\"\n\n# The example study\n\nConsider the following study. Cases are 1:1 matched to controls (on some covariates) and the case-control pairs are block randomized over the analytical assay. In other words, the matched pairs (blocks) will be randomized over the plates and batches and within the block we randomize whether the position of the case and control. In visual form:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplate)\nlibrary(ggplot2)\n\ndata(data_continuous_96)\n\nblock_possibilities <- list(c(0, 1), c(1, 0))\n\ndata_continuous_96 <- data_continuous_96 |> \n  dplyr::mutate(case = as.character(unlist(sample(block_possibilities, 48, replace = TRUE))),\n                case = ifelse(case == '1', 'Case', 'Control'),\n                pair = rep(sample(1:48), each = 2),\n                x = rnorm(96))\n\nggplate::plate_plot(\n  data = data_continuous_96,\n  position = well,\n  value = case,\n  label = pair,\n  colour = c('skyblue', 'orange'),\n  plate_size = 96,\n  plate_type = \"round\",\n  title = \"\") +\n  labs(title = \"\") +\n  theme(legend.title = element_blank())\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-1-1.png)\n:::\n\n```{.r .cell-code}\n# add plate background\n```\n:::\n\n\n# Conditional logistic regression\n\nThe most important difference between conditional logistic regression and ordinary logistic regression here is that in a conditional logistic regression only disconcordant pairs contribute to the analysis. Stratum-level unobserved variables are adjusted away.\n\nmath\n\nIn `R` you can easily fit a conditional logistic regression using the `clogit` function from the `surival` package[^2].\n\n[^2]: Apparently you can also fit a conditional logistic regression model [using a random effect model!](https://www.metafor-project.org/doku.php/tips:clogit_paired_binary_data) (in some cases (?))\n\n\n::: {.cell evaluate='false'}\n\n```{.r .cell-code}\nlibrary(survival)\nsurvival::clogit(is_case ~ 1 + survival::strata(pair) + x, \n                 data = data_continuous_96 |> dplyr::mutate(is_case = case == \"Case\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCall:\nsurvival::clogit(is_case ~ 1 + survival::strata(pair) + x, data = dplyr::mutate(data_continuous_96, \n    is_case = case == \"Case\"))\n\n                                   coef exp(coef)  se(coef)      z     p\nsurvival::strata(pair)pair=2  -0.080653  0.922514  1.999949 -0.040 0.968\nsurvival::strata(pair)pair=3  -0.171148  0.842697  2.033581 -0.084 0.933\nsurvival::strata(pair)pair=4  -0.126181  0.881455  2.016598 -0.063 0.950\nsurvival::strata(pair)pair=5  -0.112065  0.893987  2.011144 -0.056 0.956\nsurvival::strata(pair)pair=6  -0.100678  0.904224  2.005590 -0.050 0.960\nsurvival::strata(pair)pair=7  -0.143114  0.866655  2.020392 -0.071 0.944\nsurvival::strata(pair)pair=8   0.037166  1.037865  1.992281  0.019 0.985\nsurvival::strata(pair)pair=9  -0.052698  0.948667  1.994284 -0.026 0.979\nsurvival::strata(pair)pair=10 -0.190933  0.826188  2.043115 -0.093 0.926\nsurvival::strata(pair)pair=11 -0.017756  0.982401  1.990678 -0.009 0.993\nsurvival::strata(pair)pair=12 -0.083457  0.919930  2.000524 -0.042 0.967\nsurvival::strata(pair)pair=13 -0.206814  0.813171  2.053342 -0.101 0.920\nsurvival::strata(pair)pair=14 -0.099270  0.905498  2.005430 -0.050 0.961\nsurvival::strata(pair)pair=15  0.019840  1.020038  1.996076  0.010 0.992\nsurvival::strata(pair)pair=16 -0.121914  0.885225  2.012953 -0.061 0.952\nsurvival::strata(pair)pair=17 -0.231038  0.793709  2.066927 -0.112 0.911\nsurvival::strata(pair)pair=18 -0.086583  0.917059  2.001213 -0.043 0.965\nsurvival::strata(pair)pair=19 -0.175666  0.838898  2.035827 -0.086 0.931\nsurvival::strata(pair)pair=20 -0.097650  0.906966  2.004266 -0.049 0.961\nsurvival::strata(pair)pair=21 -0.231517  0.793329  2.068385 -0.112 0.911\nsurvival::strata(pair)pair=22 -0.118267  0.888459  2.010785 -0.059 0.953\nsurvival::strata(pair)pair=23 -0.014309  0.985793  1.992622 -0.007 0.994\nsurvival::strata(pair)pair=24 -0.051963  0.949364  1.994498 -0.026 0.979\nsurvival::strata(pair)pair=25 -0.015478  0.984641  1.990811 -0.008 0.994\nsurvival::strata(pair)pair=26 -0.103441  0.901729  2.005993 -0.052 0.959\nsurvival::strata(pair)pair=27 -0.065935  0.936192  1.997203 -0.033 0.974\nsurvival::strata(pair)pair=28 -0.155364  0.856103  2.025481 -0.077 0.939\nsurvival::strata(pair)pair=29 -0.095463  0.908952  2.004756 -0.048 0.962\nsurvival::strata(pair)pair=30 -0.024223  0.976068  1.992134 -0.012 0.990\nsurvival::strata(pair)pair=31 -0.118326  0.888406  2.011417 -0.059 0.953\nsurvival::strata(pair)pair=32 -0.108256  0.897398  2.007797 -0.054 0.957\nsurvival::strata(pair)pair=33 -0.038374  0.962353  1.992810 -0.019 0.985\nsurvival::strata(pair)pair=34 -0.137396  0.871625  2.018518 -0.068 0.946\nsurvival::strata(pair)pair=35 -0.046203  0.954848  1.993587 -0.023 0.982\nsurvival::strata(pair)pair=36 -0.044356  0.956613  1.993114 -0.022 0.982\nsurvival::strata(pair)pair=37 -0.070880  0.931574  1.997736 -0.035 0.972\nsurvival::strata(pair)pair=38 -0.121438  0.885646  2.012948 -0.060 0.952\nsurvival::strata(pair)pair=39 -0.149824  0.860859  2.023660 -0.074 0.941\nsurvival::strata(pair)pair=40 -0.126578  0.881106  2.014955 -0.063 0.950\nsurvival::strata(pair)pair=41 -0.064971  0.937095  2.001113 -0.032 0.974\nsurvival::strata(pair)pair=42 -0.141906  0.867703  2.019506 -0.070 0.944\nsurvival::strata(pair)pair=43  0.004308  1.004318  1.990347  0.002 0.998\nsurvival::strata(pair)pair=44 -0.196682  0.821452  2.046994 -0.096 0.923\nsurvival::strata(pair)pair=45 -0.138259  0.870873  2.020980 -0.068 0.945\nsurvival::strata(pair)pair=46 -0.132323  0.876058  2.015914 -0.066 0.948\nsurvival::strata(pair)pair=47 -0.020070  0.980130  1.992680 -0.010 0.992\nsurvival::strata(pair)pair=48 -0.033773  0.966791  1.991890 -0.017 0.986\nx                              0.104914  1.110615  0.253315  0.414 0.679\n\nLikelihood ratio test=0.17  on 48 df, p=1\nn= 96, number of events= 48 \n```\n\n\n:::\n:::\n\n\n# Technical variation\n\n## Adjustment\n\nNo matter how extensive we model this drift and remove this variation, the remaining variation will be greater than the technical drift over one position in the data. And the latter is precisely the variation that the conditional logistic regression will utilize in our well designed example study. The unobserved stratum-level variables is the technical drift here (?).\n\n# Caveats\n\nMaybe conditional on total total amount of variation in study.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}